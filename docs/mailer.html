<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
	This program is free software; you can redistribute it and/or
	modify it under the terms of the GNU General Public License 
	as published by the Free Software Foundation; either version 2 
	of the License, or (at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
	GNU General Public License for more details.
	
	You should have received a copy of the GNU General Public License
	along with this program; if not, write to the Free Software
	Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr" dir="ltr">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	
	<title>WAmailer 2.1 : Classe d'envoi d’emails complète</title>
	
	<meta name="Author" content="Bobe" />
	<meta name="Editor" content="jEdit" />
	<meta name="Copyright" content="phpCodeur (c) 2002-2005" />
	
	<link rel="copyright" href="http://www.gnu.org/copyleft/gpl.html" title="Copyleft" />
	
	<style type="text/css" media="screen">
	/* 
		WAnewsletter theme by Bobe wascripts&#x40;phpcodeur.net 
	*/
	body {
		margin: 0;
		background-color: #003B78;
		font-family: Verdana, Arial, Helvetica, sans-serif;
		color: white;
	}
	
	#smallheader, #global, #footer {
		margin: 20px;
		padding: 0;
		background-color: #DDD;
		border: 1px solid black;
		text-align: center;
		color: black;
	}
	
	#smallheader h1 {
		margin: 0.4em;
		background-color: inherit;
		text-align: center;
		font-weight: bold;
		font-size: 1em;
		color: black;
	}
	
	#footer {
		margin-bottom: 40px !important;
	}
	
	#footer p {
		margin: .4em;
		background-color: inherit;
		text-align: center;
		font-weight: bold;
		font-size: .6em;
		color: black;
	}
	
	#preface {
		margin: 1em 2.5%;
		background-color: inherit;
		text-align: left;
		font-size: .7em;
		color: #000;
	}
	
	.bloc {
		margin: 1em 2.5%;
		padding: 0;
		background-color: #DDD;
		border: 1px solid #084A6B;
		color: black;
	}
	
	.bloc h2 {
		margin: 0;
		padding-top: 5px;
		height: 22px;
		background: #003B78 url("../templates/images/head.gif") top repeat-x;
		font-size: .8em;
		color: #FAFAFA;
	}
	
	.bloc h3 {
		margin: 0;
		padding: 1em 1.4em;
		background-color: transparent;
		text-align: left;
		font-weight: bold;
		font-size: .8em;
	}
	
	.bloc p {
		margin: 0;
		padding: 1em;
		background-color: transparent;
		text-align: left;
		font-weight: normal;
		font-size: .7em;
		line-height: 1.2em;
	}
	
	ul.som {
		text-align: left;
		list-style-type: upper-roman;
		font-weight: normal;
		font-size: .7em;
		line-height: 1.3em;
	}
	
	ul.som ul {
		text-align: left;
		list-style-type: decimal;
	}
	
	.bloc p.anchor { text-align: right; }
	
	a, a:link, a:visited {
		background-color: transparent; 
		text-decoration: none;
		font-size: inherit;
		color: #25F;
	}
	
	a:hover {
		background-color: transparent;
		text-decoration: none;
		font-size: inherit;
		color: #F52;
	}
	
	acronym {
		background-color: transparent;
		border-bottom: 1px dotted blue;
		text-transform: uppercase;
	}
	
	acronym:hover {
		cursor: help;
	}
	
	.code {
		background-color: #FAFAFA;
		border: 1px dashed #A4A6A8;
		margin: .4em 1em;
		padding: .4em;
		text-align: left;
		font-weight: normal;
		font-size: .8em;
		line-height: 1.2em;
		font-family: Courier, "Courier New", monospace !important;
	}
	</style>
</head>
<body id="top">

<div id="smallheader">
	<h1>Documentation WAmailer 2.1</h1>
</div>

<div id="global">
	
	<div class="bloc">
	<h2>Sommaire</h2>
	
	<ul class="som">
	  <li> <a href="#1">Liste des méthodes de la classe</a> <br /><br />
		<ul>
		  <li> <a href="#1.1">Mailer()</a> </li>
		  <li> <a href="#1.2">use_smtp()</a> </li>
		  <li> <a href="#1.3">use_sendmail()</a> </li>
		  <li> <a href="#1.4">set_root()</a> </li>
		  <li> <a href="#1.5">set_format()</a> </li>
		  <li> <a href="#1.6">validate_email()</a> </li>
		  <li> <a href="#1.7">validate_email_mx()</a> </li>
		  <li> <a href="#1.8">set_from()</a> </li>
		  <li> <a href="#1.9">set_address()</a> ( anciennement set_to() ) </li>
		  <li> <a href="#1.10">set_subject()</a> </li>
		  <li> <a href="#1.11">set_message()</a> </li>
		  <li> <a href="#1.12">set_altmessage()</a> </li>
		  <li> <a href="#1.13">use_template()</a> </li>
		  <li> <a href="#1.14">assign_tags()</a> </li>
		  <li> <a href="#1.15">assign_block_tags()</a> </li>
		  <li> <a href="#1.16">attachment()</a> </li>
		  <li> <a href="#1.17">set_reply_to()</a> </li>
		  <li> <a href="#1.18">set_return_path()</a> </li>
		  <li> <a href="#1.19">set_notify()</a> </li>
		  <li> <a href="#1.20">organization()</a> </li>
		  <li> <a href="#1.21">set_priority()</a> </li>
		  <li> <a href="#1.22">additionnal_header()</a> ( anciennement set_header() ) </li>
		</ul><br />
	  </li>
	  <li> <a href="#2">Propriétés de la classe</a> <br /><br />
		<ul>
		  <li> <a href="#2.1">smtp_mode</a> </li>
		  <li> <a href="#2.2">persistent_connection</a> </li>
		  <li> <a href="#2.3">sendmail_mode</a> </li>
		  <li> <a href="#2.4">sendmai_path</a> </li>
		  <li> <a href="#2.5">sendmail_cmd</a> </li>
		  <li> <a href="#2.6">text_tpl_ext</a> </li>
		  <li> <a href="#2.7">html_tpl_ext</a> </li>
		  <li> <a href="#2.8">hebergeur</a> </li>
		  <li> <a href="#2.9">format</a> </li>
		  <li> <a href="#2.10">charset</a> </li>
		  <li> <a href="#2.11">encoding</a> </li>
		  <li> <a href="#2.12">server_from</a> </li>
		  <li> <a href="#2.13">valid_syntax</a> </li>
		  <li> <a href="#2.14">debug</a> </li>
		  <li> <a href="#2.15">statut</a> </li>
		  <li> <a href="#2.16">msg_error</a> </li>
		  <li> <a href="#2.17">fix_bug_mail</a> </li>
		</ul><br />
	  </li>
	  <li> <a href="#3">A propos des tags</a> </li>
	  <li> <a href="#4">A propos des modèles</a> </li>
	  <li> <a href="#5">Fonctionnement de l'envoi sur plusieurs destinataires</a> </li>
	  <li> <a href="#6">Exemple: Envoi d'un email simple au format texte</a> </li>
	  <li> <a href="#7">Exemple: Envoi d'un email au format html, avec pièces jointes et incorporées</a> </li>
	</ul>
	</div>
	
	<div class="bloc">
	<h2>I. Liste des méthodes de la classe<a name="1"></a></h2>
	
	<h3><a name="1.1">Initialisation de la classe</a></h3>
	
	<p>
	<i>void</i> <b>Mailer</b> ( <i>[string root]</i> ) <br />
	<br />
	Cette méthode accepte un argument facultatif.<br />
	Si vous utilisez un modèle d'email et que celui ci ne se trouve pas dans le dossier par défaut 
	(défini dans le fichier mailer.php), vous pouvez indiquer le chemin vers le dossier contenant les modèles. <br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">$mailer </span><span style="color: #007700;">= new </span><span style="color: #0000BB;">Mailer</span><span style="color: #007700;">();</span>
	</div>
	
	<h3><a name="1.2">Activation de l'option smtp</a></h3>
	
	<p>
	<i>void</i> <b>use_smtp</b> ( string hostname <i>[,int port [,string user [,string pass [,string server_from]]]]</i> ) <br />
	<br />
	Si vous voulez utiliser un serveur <acronym title="Simple Mail Transfert Protocol" xml:lang="en">smtp</acronym> spécifique pour vos envois, vous devez indiquer dans ce cas les paramètres de connexions 
	au serveur smtp de votre choix, <i>string user</i> et <i>string pass</i> pour l'authentification (si le serveur smtp supporte 
	l'authentification). <br />
	<i>int port</i> est le port auquel se connecter, la valeur par défaut, 25, suffira la plupart du temps.<br />
	<br />
	Vous pouvez également mettre les paramètres de connexion directement dans la classe smtp (fichier class.smtp.php), 
	ce qui vous évitera de faire appel à use_smtp() (vous devrez mettre aussi la propriété <i>smtp_mode</i> à true dans la classe mailer <br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">use_smtp</span><span style="color: #007700;">(</span><span style="color: #DD0000;">"smtp.wanadoo.fr"</span><span style="color: #007700;">, </span><span style="color: #0000BB;">25</span><span style="color: #007700;">);</span>
	</div>
	
	<h3><a name="1.3">Activation de l'option sendmail</a></h3>
	
	<p>
	<i>boolean</i> <b>use_sendmail</b> ( <i>[ string sendmail_cmd [,string sendmail_path ]]</i> ) <br />
	<br />
	Si vous voulez utiliser sendmail directement, utilisez cette méthode. <br />
	Vous pouvez passer des commandes supplémentaires à sendmail avec le premier argument, et vous devez indiquer le chemin d'accés 
	à sendmail en deuxième argument. <br />
	Là aussi, vous pouvez effectuer ces réglages directement dans la classe Mailer (et mettre sendmail_mode à true)<br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">use_sendmail</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'-t'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'/usr/bin/sendmail'</span><span style="color: #007700;">);</span>
	</div>
	
	<h3><a name="1.4">Définir le dossier des modèles</a></h3>
	
	<p>
	<i>boolean</i> <b>set_root</b> ( string template_path ) <br />
	<br />
	Fournit le chemin vers le dossier contenant les modèles d'emails
	</p>
	
	<h3><a name="1.5">Définition du format de l'email</a></h3>
	
	<p>
	<i>void</i> <b>set_format</b> ( mixed format ) <br />
	<br />
	Définit le format de l'email <br />
	Pour un email au format texte, vous devez fournir en argument : txt, text, texte ou 1<br />
	Pour un email au format <acronym title="HyperText Markup Language" xml:lang="en">html</acronym>, vous devez fournir en argument : htm, html ou 2<br />
	Pour un email au format multi-format, vous devez fournir en argument : alt ou 3<br />
	<br />
	Si vous voulez envoyer un email dans un format autre que celui par défaut (défini avec la 
	propriété <i>format</i> dans la classe), vous <b>devez</b> appeller la méthode <b>set_format()</b> avant d'appeller 
	<b>set_message()</b>, <b>set_altmessage()</b> ou <b>use_template()</b>
	</p>
	
	<h3><a name="1.6">Validation syntaxique des emails</a></h3>
	
	<p>
	<i>boolean</i> <b>validate_email</b> ( string email ) <br />
	<br />
	Renvoie true si l'email passé en argument est syntaxiquement valide, false sinon <br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">validate_email</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'toto@domaine.com'</span><span style="color: #007700;">);</span>
	</div>
	
	<p>
	Cette méthode peut être appellée sans instancier la classe mailer. <br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
Mailer::validate_email(<span style="color: #DD0000;">'toto@domaine.com'</span>);
	</div>
	
	<p>
	Pour que les emails fournis via les méthodes telles que <b>set_from()</b> ou encore <b>set_address()</b> soient d'abord 
	validées avec <b>validate_email()</b>, mettez la propriété <i>valid_syntax</i> à true dans la classe mailer.
	</p>
	
	<h3><a name="1.7">Validation réelle des emails</a></h3>
	
	<p>
	<i>boolean</i> <b>validate_email_mx</b> ( string email ) <br />
	<br />
	Renvoie true si l'email passé en argument existe réellement, false sinon <br />
	Ce n'est pas une méthode miracle pour vérifier si une adresse email est réelle. <br />
	Cette méthode se base sur le fait que la majorité des serveurs smtp refuse le relaying (accepter la demande d'une entité 
	extérieure à son réseau et pour destinataire une adresse extérieure elle aussi au réseau), mais il y en a quand même qui l'accepte. <br />
	La méthode s'assure néanmoins que le domaine de l'email a bien un échangeur d'email (<b>M</b>ail e<b>X</b>changer). <br />
	(Fonctionne aussi sous windows) 
	</p>
	
	<h3><a name="1.8">Définition de l'adresse expéditrice</a></h3>
	
	<p>
	<i>boolean</i> <b>set_from</b> ( string email <i>[, string name]</i> ) <br />
	<br />
	<i>string from</i> correspond à l'adresse email de l'envoyeur. <br />
	Vous pouvez également spécifier <i>string name</i> pour personnaliser le nom de l'expéditeur, dans ce cas, 
	c'est lui qui apparaitra dans le client mail du destinataire.
	</p>
	
	<h3><a name="1.9">Définition des destinataires</a></h3>
	
	<p>
	<i>boolean</i> <b>set_address</b> ( mixed email <i>[, string type ]</i> ) <br />
	<br />
	Anciennement <b>set_to()</b> (qui marche toujours, renvoie simplement les données à <b>set_address()</b>)<br />
	<br />
	Cette méthode accepte en premier argument une chaîne de caractères représentant une adresse email, ou bien un tableau contenant les adresses 
	email de tous les destinataires. <br />
	Vous pouvez indiquer comme deuxieme argument <acronym title="Carbon copy" xml:lang="en">Cc</acronym> (carbon copy) ou <acronym title="Blind Carbon Copy" xml:lang="en">Bcc</acronym> (blind carbon copy) selon ce que vous désirez. <br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">
$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_address</span><span style="color: #007700;">(</span><span style="color: #DD0000;">"jojo@domaine.com"</span><span style="color: #007700;">); 
<br />
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_address</span><span style="color: #007700;">(array(
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000;">"jojo@domaine.com"</span><span style="color: #007700;">,
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000;">"copain@azerty.net" 
<br /></span><span style="color: #007700;">), </span><span style="color: #DD0000;">'bcc'</span><span style="color: #007700;">);
<br /></span>
	</div>
	
	<p>
	Vous pouvez personnaliser la aussi le nom du destinataires en utilisant son pseudo (ou autre) comme index du tableau fourni.<br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_address</span><span style="color: #007700;">(array( 
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000;">"jojo@domaine.com"</span><span style="color: #007700;">, 
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000;">'fred' </span><span style="color: #007700;">=&gt; </span><span style="color: #DD0000;">"copain@azerty.net" 
<br /></span><span style="color: #007700;">));</span>
	</div>
	
	<h3><a name="1.10">Définition du sujet de l'email</a></h3>
	
	<p>
	<i>void</i> <b>set_subject</b> ( string subject ) <br />
	<br />
	Définit tout simplement le sujet de l'email à envoyer.
	</p>
	
	<h3><a name="1.11">Définition du message proprement dit</a></h3>
	
	<p>
	<i>void</i> <b>set_message</b> ( string message	 <i>[, array tags ]</i> ) <br />
	<br />
	Le corps de l'email.<br />
	Vous pouvez passer en deuxième argument un tableau contenant les tags à remplacer dans le texte. (voir 
	section III de la présente documentation)
	</p>
	
	<h3><a name="1.12">Définition du message alternatif</a></h3>
	
	<p>
	<i>void</i> <b>set_altmessage</b> ( string altmessage  <i>[, array tags ]</i> ) <br />
	<br />
	Le message alternatif pour les logiciels de courriel ne supportant pas le format <acronym title="HyperText Markup Language" xml:lang="en">html</acronym> (si vous envoyez un mail multi-format)<br />
	Vous pouvez passer en deuxième argument un tableau contenant les tags à remplacer dans le texte. (voir 
	section III de la présente documentation)
	</p>
	
	<h3><a name="1.13">Définition du modèle à utiliser</a></h3>
	
	<p>
	<i>boolean</i> <b>use_template</b> ( string template_name <i>[, array tags ]</i> ) <br />
	<br />
	Vous devez passer en premier argument le nom du modèle à utiliser (nom du fichier sans l'extension) . <br />
	Si vous envoyez un email au format texte, le fichier doit avoir l'extension .txt, si c'est au format html, 
	le fichier doit avoir l'extension .html, enfin, si vous envoyez un email multi format, les deux fichiers 
	doivent être présent dans le dossier spécifié. (vous pouvez toutefois changer ces extensions, 
	regardez du coté des propriétés <i>text_tpl_ext</i> et <i>html_tpl_ext</i>) <br />
	<br />
	Vous pouvez passer en deuxième argument un tableau contenant les tags à remplacer dans le texte. (voir 
	section III de la présente documentation)<br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">use_template</span><span style="color: #007700;">(</span><span style="color: #DD0000;">"new_mail"</span><span style="color: #007700;">, array(
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000;">'PSEUDO' </span><span style="color: #007700;">=&gt; </span><span style="color: #DD0000;">'testeur'</span><span style="color: #007700;">,
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000;">'TEST' </span><span style="color: #007700;">=&gt; </span><span style="color: #DD0000;">'ceci est un test'
<br /></span><span style="color: #007700;">));</span>
	</div>
	
	<h3><a name="1.14">Assignation de tags</a></h3>
	
	<p>
	<i>void</i> <b>assign_tags</b> ( array tags ) <br />
	<br />
	A appeller si vous souhaitez ajouter des tags à remplacer (voir section III de la présente documentation).
	</p>
	
	<h3><a name="1.15">Assignation de blocks de tags</a></h3>
	
	<p>
	<i>void</i> <b>assign_block_tags</b> ( string blockname <i>[, array tags ]</i> ) <br />
	<br />
	A appeller si vous souhaitez ajouter des blocks de tags à remplacer. <br />
	Vous pouvez passer en deuxième argument un tableau contenant les tags spécifiques à ce block que vous souhaitez 
	remplacer (voir section III de la présente documentation).<br />
	La classe ne supporte pas actuellement les blocks imbriqués non plus que les blocks répétés. 
	A n'utiliser que pour des blocks conditionnels donc.
	</p>
	
	<h3><a name="1.16">Attachement de fichiers joints ou incorporés</a></h3>
	
	<p>
	<i>boolean</i> <b>attachment</b> ( string path <i>[, string filename [, string disposition [, string mime-type [, boolean embedded ]]]]</i> ) <br />
	<br />
	string path : le chemin vers le fichier <br />
	string filename : nom du fichier (si omis, le nom du fichier dans path sera utilisé) <br />
	string disposition : inline ou attachment <br />
	string mime-type : mime_type du fichier <br />
	boolean embedded : true si le fichier doit être intégré dans le corps du message (seulement si email html) <br />
	Si le fichier est incorporé dans le message html (embedded) vous devez utiliser cid:nom_du_fichier en lieu 
	et place du contenu de l'attribut src de la balise html. <br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">attachment</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'../rep/image.gif'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'new_name.gif'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">''</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'image/gif'</span><span style="color: #007700;">, </span><span style="color: #0000BB;">true</span><span style="color: #007700;">);</span>
	</div>
	
	<p>
	Et dans le corps du message : &lt;img src="cid:new_name.gif" border="0" /&gt; là où vous le souhaitez
	</p>
	
	<h3><a name="1.17">Définition de l'adresse de réponse</a></h3>
	
	<p>
	<i>boolean</i> <b>set_reply_to</b> ( <i>[ string email_reply ]</i> ) <br />
	<br />
	Si l'argument est omis, l'adresse définie en from sera utilisée.
	</p>
	
	<h3><a name="1.18">Définition de l'adresse de retour d'erreurs</a></h3>
	
	<p>
	<i>boolean</i> <b>set_return_path</b> ( <i>[ string email_return ]</i> ) <br />
	<br />
	Si l'argument est omis, l'adresse définie en from sera utilisée.
	</p>
	
	<h3><a name="1.19">Définition de l'adresse de notification de lecture</a></h3>
	
	<p>
	<i>boolean</i> <b>set_notify</b> ( <i>[ string email_notify ]</i> ) <br />
	<br />
	Si l'argument est omis, l'adresse définie en from sera utilisée.
	</p>
	
	<h3><a name="1.20">Définition de l'adresse de notification de lecture</a></h3>
	
	<p>
	<i>boolean</i> <b>organization</b> ( string soc ) <br />
	<br />
	Nom de l'organisation émettrice
	</p>
	
	<h3><a name="1.21">Définition de la priorité de l'email</a></h3>
	
	<p>
	<i>void</i> <b>set_priority</b> ( mixed priority ) <br />
	<br />
	La fonction n'est pas <em>case-sensitive</em><br />
	<br />
	<em>exemple :</em>
	</p>
	
	<div class="code">
<span style="color: #0000BB;">
<br /></span><span style="color: #FF8000;">// pour une priorité très haute :
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #DD0000;">"highest"</span><span style="color: #007700;">); 
<br /></span><span style="color: #FF8000;">// ou bien
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #0000BB;">1</span><span style="color: #007700;">);
<br />
<br /></span><span style="color: #FF8000;">// pour une priorité haute :
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #DD0000;">"high"</span><span style="color: #007700;">); 
<br /></span><span style="color: #FF8000;">// ou bien
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #0000BB;">2</span><span style="color: #007700;">);
<br />
<br /></span><span style="color: #FF8000;">// pour une priorité normale (priorité par défaut si vous n'utilisez pas cette fonction) :
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #DD0000;">"normal"</span><span style="color: #007700;">); 
<br /></span><span style="color: #FF8000;">// ou bien
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #0000BB;">3</span><span style="color: #007700;">);
<br />
<br /></span><span style="color: #FF8000;">// pour une priorité basse :
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #DD0000;">"low"</span><span style="color: #007700;">); 
<br /></span><span style="color: #FF8000;">// ou bien
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #0000BB;">4</span><span style="color: #007700;">);
<br />
<br /></span><span style="color: #FF8000;">// pour une priorité très basse :
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #DD0000;">"lowest"</span><span style="color: #007700;">); 
<br /></span><span style="color: #FF8000;">// ou bien
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_priority</span><span style="color: #007700;">(</span><span style="color: #0000BB;">5</span><span style="color: #007700;">);
<br /></span>
	</div>
	
	<h3><a name="1.22">Ajout d'entêtes supplémentaires</a></h3>
	
	<p>
	<i>boolean</i> <b>additionnal_header</b> ( string name, string body ) <br />
	<br />
	Anciennement <b>set_header()</b> <br />
	Renvoie false si le nom ou le corps de l'entête contiennent des caractères interdits. <br />
	<br />
	Le nom de l'entête ne doit contenir que des caractères us-ascii et ne doit pas contenir le caractère 
	deux points (:)<br />
	Le contenu de l'entête ne doit contenir aucun retour chariot ou saut de ligne
	</p>
	
	<h3><a name="1.23">Envoi de l'email</a></h3>
	
	<p>
	<i>boolean</i> <b>send</b> ( <i>[ boolean do_not_send ]</i> ) <br />
	<br />
	Renvoie true si l'email a pu être envoyé, false sinon<br />
	<br />
	Vous pouvez passer true en argument pour afficher l'email au lieu de l'envoyer (débogguage)
	</p>
	
	<p class="anchor"><a href="#top" title="Retour en haut">Top</a></p>
	
	</div>
	
	<div class="bloc">
	
	<h2>II. Propriétés de la classe<a name="2"></a></h2>
	
	<p>Certaines propriétés de la classe méritent qu'on s'y attarde.</p>
	
	<h3><a name="2.1">smtp_mode</a></h3>
	
	<p>
	Si placée à TRUE, le mode smtp sera utilisé, vous n'aurez donc pas besoin de faire appel à la méthode 
	<b>use_smtp()</b> (pensez cependant à mettre les paramètres d'accés au serveur smtp dans la classe smtp)
	</p>
	
	<h3><a name="2.2">persistent_connection</a></h3>
	
	<p>
	Si placée à TRUE, la connexion au serveur <acronym title="Simple Mail Transfert Protocol" xml:lang="en">smtp</acronym> ne sera pas fermée après le premier envoi et sera réutilisée pour 
	un envoi ultérieur. Dans ce cas, ce sera à vous de fermer la connexion au serveur smtp, car le serveur smtp 
	n'effectue les tâches demandées qu'après la fermeture <b>proprement</b> de la connexion. <br />
	Pour fermer la connexion au serveur smtp, vous pouvez faire : $mailer->smtp->quit();
	</p>
	
	<h3><a name="2.3">sendmail_mode</a></h3>
	
	<p>
	Si placée à TRUE, le mode sendmail sera utilisé, vous n'aurez donc pas besoin de faire appel à la méthode 
	<b>use_sendmail()</b> (pensez alors à placer le chemin d'accés vers sendmail dans la propriété sendmail_path)
	</p>
	
	<h3><a name="2.4">sendmail_path</a></h3>
	
	<p>
	Mettez y le chemin d'accés vers sendmail si vous utilisez directement l'option sendmail
	</p>
	
	<h3><a name="2.5">sendmail_cmd</a></h3>
	
	<p>
	Commandes supplémentaires à l'appel de sendmail
	</p>
	
	<h3><a name="2.6">text_tpl_ext</a></h3>
	
	<p>
	Extension par défaut des modèles au format texte
	</p>
	
	<h3><a name="2.7">html_tpl_ext</a></h3>
	
	<p>
	Extension par défaut des modèles au format <acronym title="HyperText Markup Language" xml:lang="en">html</acronym>
	</p>
	
	<h3><a name="2.8">hebergeur</a></h3>
	
	<p>
	Laissez comme c'est, sauf si vous êtes chez Online
	</p>
	
	<h3><a name="2.9">format</a></h3>
	
	<p>
	Le format par défaut des emails envoyés lorsque vous ne faites pas appel à la méthode <b>set_format()</b>
	</p>
	
	<h3><a name="2.10">charset</a></h3>
	
	<p>
	Le jeu de caractère à déclarer dans l'email, changez le si nécessaire
	</p>
	
	<h3><a name="2.11">encoding</a></h3>
	
	<p>
	Encodage par défaut des emails. L'encodage quoted-printable se veut plus léger, mais n'est pas conseillé pour 
	poster sur les newsgroups (vous avez déja dù voir des sujets du type =?iso-8859-1?Q? .. etc ..)
	</p>
	
	<h3><a name="2.12">encoding</a></h3>
	
	<p>
	Nom du serveur émetteur (utilisé pour l'envoi via smtp)
	</p>
	
	<h3><a name="2.13">valid_syntax</a></h3>
	
	<p>
	Placé à FALSE par défaut. 
	Placez cette propriété à true si vous souhaitez que les emails fournis à la classe (via <b>set_from()</b>, 
	<b>set_address()</b>, etc..) soient vérifiés (vérification syntaxique)
	</p>
	
	<h3><a name="2.14">debug</a></h3>
	
	<p>
	Placé à FALSE par défaut. 
	Pour débogguer la classe
	</p>
	
	<h3><a name="2.15">statut</a></h3>
	
	<p>
	Placé à TRUE par défaut. 
	Ne modifiez pas cette propriété ! (les emails ne seraient tout simplement pas envoyés)
	</p>
	
	<h3><a name="2.16">msg_error</a></h3>
	
	<p>
	Contient le message d'erreur renvoyé par la classe si une erreur se produit.
	</p>
	
	<h3><a name="2.17">fix_bug_mail</a></h3>
	
	<p>
	Je ne donnerai pas ici de détails poussés, lisez les commentaires dans la méthode <b>recipients_list()</b> pour 
	en savoir plus. <br />
	<br />
	Vous pouvez vérifier avec un phpinfo si php utilise sendmail (en regardant si sendmail_path contient un 
	chemin vers sendmail). <br />
	Si <acronym title="PHP: Hypertext Preprocessor" xml:lang="en">php</acronym> utilise sendmail, mettez cette propriété à <b>1</b>, sinon, mettez la à <b>-1</b> <br />
	Si cette propriété est laissée à NULL, le script cherchera la réponse par lui même.
	</p>
	
	<p class="anchor"><a href="#top" title="Retour en haut">Top</a></p>
	
	</div>
	
	<div class="bloc">
	
	<h2>III. A propos des tags<a name="3"></a></h2>
	
	<p>
	Les tags sont des zones de texte spécifiques, définies par <b>%nom_du_tag%</b>, qui vous permettent de 
	les remplacer par un contenu de votre choix. <br />
	Par exemple, si vous avez un modèle générique que vous voulez utiliser pour plusieurs personnes différentes 
	et personnaliser, l'email pourrait commencer par <i>Bonjour %PSEUDO%</i>, et vous remplaceriez 
	<b>%PSEUDO%</b> par le contenu approprié à cette personne (en l'occurence le pseudo, issu d'une base 
	de données ou autre ..) <br />
	<br />
	Cela s'applique aussi dans une boucle d'envoi (et c'est évidemment là que c'est le plus utile)<br />
	<br />
	Vous pouvez également définir un block conditionnel. C'est à dire un block dont vous voulez l'affichage 
	dans certaines conditions. <br />
	Vous utiliserez donc assign_block_tags() uniquement si les conditions sont remplies, dans ce cas, 
	le texte inclu dans le block sera visible dans l'email <br />
	Un block se constitue de la manière suivante : <br />
	</p>
	
	<div class="code">
&lt;!-- start_block nom_du_block --&gt;<br />
texte à afficher si le %nom_du_block.VAR% a été déclaré avec la méthode assign_block_tags()<br />
&lt;!-- end_block nom_du_block --&gt;
	</div>
	
	<p>
	Les déclarations de début de block et de fin de block (les commentaires html) doivent être seuls sur leur ligne; 
	vous pouvez là aussi utiliser les tags mais vous remarquerez que les tags du block sont préfixés avec le nom du 
	block suivi d'un point (ceci afin d'éviter des conflits avec des tags de même nom non inclus dans un block)<br />
	<br />
	Voir le fonctionnement des méthodes assign_tags() et assign_block_tags() <br />
	<br />
	La classe ne supporte pas les blocks imbriqués, et les blocks répétés (les dernières données écraseraient 
	les autres)
	</p>
	
	<p class="anchor"><a href="#top" title="Retour en haut">Top</a></p>
	
	</div>
	
	<div class="bloc">
	
	<h2>IV. A propos des modèles<a name="4"></a></h2>
	
	<p>
	Vous pouvez, en ayant réglé le chemin vers le dossier contenant les modèles (à l'initialisation de 
	la classe, ou avec avec la méthode <b>set_root()</b>), utiliser des modèles d'emails. <br />
	Les modèles d'emails au format texte doivent avoir l'extension .txt, et ceux pour les emails au format 
	html doivent avoir l'extension .html (vous pouvez toutefois changer ces extensions, regardez du coté 
	des propriétés <i>text_tpl_ext</i> et <i>html_tpl_ext</i>) <br />
	<br />
	Si vous envoyez un email en format multiple, le modèle doit être présent au format texte <b>et</b> 
	<acronym title="HyperText Markup Language" xml:lang="en">html</acronym>, sans cela, c'est un email au 
	format html qui sera envoyé (sauf si le modèle au format html n'est pas présent)
	</p>
	
	<p class="anchor"><a href="#top" title="Retour en haut">Top</a></p>
	
	</div>
	
	<div class="bloc">
	
	<h2>V. Fonctionnement de l'envoi sur plusieurs destinataires<a name="5"></a></h2>
	
	<p>
	Si vous faites plusieurs envois successifs, sachez que la classe garde toutes les données que vous lui avez fournies, 
	aussi, si vous effectuez un second envoi, vous n'avez plus qu'à lui fournir les données qui changent par rapport 
	à l'envoi précédent (ex: envois à plusieurs destinataires, et seul l'email de destination change, inutile de refournir au script 
	le sujet de l'email, le texte, les éventuels fichiers joints, l'email expéditeur ..etc..) <br />
	<br />
	Pour remettre à zéro les variables contenant les données que vous voulez changer, vous avez à votre disposition 
	plusieurs méthodes dont le nom est de type clear_*() <br />
	ainsi : clear_to(), clear_from(), clear_subject(), clear_message(), clear_attach() et clear_all() <br />
	<br />
	Leur nom devrait vous donner une bonne indication des données qu'ils réinitialisent ;) <br />
	<br />
	clear_all() est équivalent à la méthode init() de la version 1.x
	</p>
	
	<p class="anchor"><a href="#top" title="Retour en haut">Top</a></p>
	
	</div>
	
	<div class="bloc">
	
	<h2>VI. Exemple: Envoi d'un email simple au format texte<a name="6"></a></h2>
	
	<p>
	Voici un exemple d'envoi d'email. <br />
	Ici, nous envoyons un email au format texte (le format par défaut), il y a un destinataire principal, et nous 
	ajoutons un destinataire en copie cachée. 
	</p>
	
	<div class="code">
<span style="color: #000000;">
<span style="color: #0000BB;">&lt;?php
<br />
<br /></span><span style="color: #007700;">include(</span><span style="color: #DD0000;">'./class.mailer.php'</span><span style="color: #007700;">); 
<br />
<br /></span><span style="color: #0000BB;">$mailer </span><span style="color: #007700;">= new </span><span style="color: #0000BB;">Mailer</span><span style="color: #007700;">(); 
<br />
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_from</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'toto@domaine.com'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'toto'</span><span style="color: #007700;">); 
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_address</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'blob@domaine.net'</span><span style="color: #007700;">);
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_address</span><span style="color: #007700;">(array(
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000;">'fred' </span><span style="color: #007700;">=&gt; </span><span style="color: #DD0000;">'fred@domaine.org'
<br /></span><span style="color: #007700;">), </span><span style="color: #DD0000;">'bcc'</span><span style="color: #007700;">); 
<br />
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_subject</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'Hello world !'</span><span style="color: #007700;">);
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_message</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'Je voulais juste faire un petit coucou, 
<br />
<br />A bientôt :)'</span><span style="color: #007700;">);
<br />
<br />if( !</span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">send</span><span style="color: #007700;">() )
<br />{
<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </span><span style="color: #DD0000;">"l'email n'a pu être envoyé"</span><span style="color: #007700;">;
<br />}
<br />
<br /></span><span style="color: #0000BB;">?&gt;</span>
</span> 
	</div>
	
	<p class="anchor"><a href="#top" title="Retour en haut">Top</a></p>
	
	</div>
	
	<div class="bloc">
	
	<h2>VII. Exemple: Envoi d'un email au format html, avec pièces jointes et incorporées<a name="7"></a></h2>
	
	<p>
	Ici, on envoie un email au format html à blob&#x40;domaine.net. <br />
	On a également ajouter un fichier zip en fichier attaché, ainsi qu'une image gif que nous utilisons au sein de 
	l'email html.
	</p>
	
	<div class="code">
<span style="color: #000000;">
<span style="color: #0000BB;">&lt;?php
<br />
<br /></span><span style="color: #007700;">include(</span><span style="color: #DD0000;">'./class.mailer.php'</span><span style="color: #007700;">); 
<br />
<br /></span><span style="color: #0000BB;">$subject </span><span style="color: #007700;">= </span><span style="color: #DD0000;">'Hello world !'</span><span style="color: #007700;">; 
<br />
<br /></span><span style="color: #0000BB;">$message&nbsp;&nbsp;</span><span style="color: #007700;">= </span><span style="color: #DD0000;">'&lt;html&gt;&lt;body&gt;'</span><span style="color: #007700;">;
<br /></span><span style="color: #0000BB;">$message </span><span style="color: #007700;">.= </span><span style="color: #DD0000;">'salut &lt;b&gt;tout le monde&lt;/b&gt;, &lt;br /&gt;&lt;br /&gt;'</span><span style="color: #007700;">;
<br /></span><span style="color: #0000BB;">$message </span><span style="color: #007700;">.= </span><span style="color: #DD0000;">'Je voulais juste faire un petit %TAG1%&lt;br /&gt;&lt;br /&gt;'</span><span style="color: #007700;">;
<br /></span><span style="color: #0000BB;">$message </span><span style="color: #007700;">.= </span><span style="color: #DD0000;">'Voila une image : &lt;br/&gt;&lt;img src="cid:picture.gif" border="0" /&gt;'</span><span style="color: #007700;">; 
<br /></span><span style="color: #0000BB;">$message </span><span style="color: #007700;">.= </span><span style="color: #DD0000;">'&lt;br /&gt;&lt;br /&gt;A bientôt :)&lt;/body&gt;&lt;/html&gt;'</span><span style="color: #007700;">;
<br />
<br /></span><span style="color: #0000BB;">$mailer </span><span style="color: #007700;">= new </span><span style="color: #0000BB;">Mailer</span><span style="color: #007700;">(); 
<br />
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_from</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'toto@domaine.com'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'toto'</span><span style="color: #007700;">); 
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_address</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'blob@domaine.net'</span><span style="color: #007700;">);
<br />
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_format</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'html'</span><span style="color: #007700;">);
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_subject</span><span style="color: #007700;">(</span><span style="color: #0000BB;">$subject</span><span style="color: #007700;">);
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">set_message</span><span style="color: #007700;">(</span><span style="color: #0000BB;">$message</span><span style="color: #007700;">, array(
<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000;">'TAG1' </span><span style="color: #007700;">=&gt; </span><span style="color: #DD0000;">'coucou'
<br /></span><span style="color: #007700;">));
<br />
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">attachment</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'./rep/fichier.zip'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'compressed_file.zip'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'attachment'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'application/x-zip-compressed'</span><span style="color: #007700;">);
<br /></span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">attachment</span><span style="color: #007700;">(</span><span style="color: #DD0000;">'./rep_images/image1.gif'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'picture.gif'</span><span style="color: #007700;">, </span><span style="color: #DD0000;">''</span><span style="color: #007700;">, </span><span style="color: #DD0000;">'image/gif'</span><span style="color: #007700;">, </span><span style="color: #0000BB;">true</span><span style="color: #007700;">);
<br />
<br />if( !</span><span style="color: #0000BB;">$mailer</span><span style="color: #007700;">-&gt;</span><span style="color: #0000BB;">send</span><span style="color: #007700;">() )
<br />{
<br />&nbsp;&nbsp;&nbsp;&nbsp;echo </span><span style="color: #DD0000;">"l'email n'a pu être envoyé"</span><span style="color: #007700;">;
<br />}
<br />
<br /></span><span style="color: #0000BB;">?&gt;</span>
</span>
	</div>
	
	<p class="anchor"><a href="#top" title="Retour en haut">Top</a></p>
	
	</div>
	
</div>

<div id="footer">
	<p>Powered by <a href="http://phpcodeur.net/">phpCodeur</a> &copy; 2002-2005 | WAmailer 2.1 <br />
	Ce script est distribué librement sous <a href="http://phpcodeur.net/wascripts/GPL">licence
	<acronym title="General Public Licence" xml:lang="en" lang="en">GPL</acronym></a></p>
</div>

</body>
</html>